(()=>{var y=Object.defineProperty;var f=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable;var m=(l,e,r)=>e in l?y(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r,_=(l,e)=>{for(var r in e||(e={}))b.call(e,r)&&m(l,r,e[r]);if(f)for(var r of f(e))h.call(e,r)&&m(l,r,e[r]);return l};var d=class{constructor({wrapper:e,page:r,frm:a,bom_configurator:t}){this.$wrapper=$(e),this.page=r,this.bom_configurator=t,this.frm=a,this.make(),this.prepare_layout(),this.bind_events()}add_boms(){this.frm.call({method:"add_boms",freeze:!0,doc:this.frm.doc})}make(){let e=_(_({},this.tree_options()),this.tree_methods());frappe.views.trees["BOM Configurator"]=new frappe.views.TreeView(e),this.tree_view=frappe.views.trees["BOM Configurator"]}bind_events(){frappe.views.trees["BOM Configurator"].events={frm:this.frm,add_item:this.add_item,add_sub_assembly:this.add_sub_assembly,set_query_for_workstation:this.set_query_for_workstation,get_sub_assembly_modal_fields:this.get_sub_assembly_modal_fields,convert_to_sub_assembly:this.convert_to_sub_assembly,delete_node:this.delete_node,edit_bom:this.edit_bom,load_tree:this.load_tree,set_default_qty:this.set_default_qty}}tree_options(){return{parent:this.$wrapper.get(0),body:this.$wrapper.get(0),doctype:"BOM Configurator",page:this.page,expandable:!0,title:__("Configure Product Assembly"),breadcrumb:"Manufacturing",get_tree_nodes:"erpnext.manufacturing.doctype.bom_creator.bom_creator.get_children",root_label:this.frm.doc.item_code,disable_add_node:!0,get_tree_root:!1,show_expand_all:!1,extend_toolbar:!1,do_not_make_page:!0,do_not_setup_menu:!0}}tree_methods(){var a;let e=this,r=frappe.views.trees["BOM Configurator"];return{onload:function(t){t.args.parent_id=e.frm.doc.name,t.args.parent=e.frm.doc.item_code,t.parent=e.$wrapper.get(0),t.body=e.$wrapper.get(0),t.make_tree()},onrender(t){let i=t.data.qty||e.frm.doc.qty,o=t.data.uom||e.frm.doc.uom,n=t.data.name||e.frm.doc.name,s=t.data.amount;t.data.value===e.frm.doc.item_code&&(s=e.frm.doc.raw_material_cost),s=frappe.format(s,{fieldtype:"Currency",currency:e.frm.doc.currency}),$(`
					<div class="pill small pull-right bom-qty-pill"
						style="background-color: var(--bg-white);
							color: var(--text-on-gray);
							font-weight:450;
							margin-right: 40px;
							display: inline-flex;
							min-width: 128px;
							border: 1px solid var(--bg-gray);
						">
							<div style="padding-right:5px" data-bom-qty-docname="${n}">${i} ${o}</div>
							<div class="fg-item-amt" style="padding-left:12px; border-left:1px solid var(--bg-gray)">
								${s}
							</div>
					</div>

				`).insertBefore(t.$ul)},toolbar:((a=this.frm)==null?void 0:a.doc.docstatus)===0?[{label:__(frappe.utils.icon("edit","sm")+" BOM"),click:function(t){let i=frappe.views.trees["BOM Configurator"];i.events.edit_bom(t,i)},btnClass:"hidden-xs"},{label:__(frappe.utils.icon("add","sm")+" Raw Material"),click:function(t){let i=frappe.views.trees["BOM Configurator"];i.events.add_item(t,i)},condition:function(t){return t.expandable},btnClass:"hidden-xs"},{label:__(frappe.utils.icon("add","sm")+" Sub Assembly"),click:function(t){let i=frappe.views.trees["BOM Configurator"];i.events.add_sub_assembly(t,i)},condition:function(t){return t.expandable},btnClass:"hidden-xs"},{label:__("Expand All"),click:function(t){let i=frappe.views.trees["BOM Configurator"];t.expanded?(t.$tree_link.trigger("click"),t.$toolbar.find(".expand-all-btn").html("Expand All")):(i.tree.load_children(t,!0),$(t.parent[0]).find(".tree-children").show(),t.$toolbar.find(".expand-all-btn").html("Collapse All"))},condition:function(t){return t.expandable&&t.is_root},btnClass:"hidden-xs expand-all-btn"},{label:__(frappe.utils.icon("move","sm")+" Sub Assembly"),click:function(t){let i=frappe.views.trees["BOM Configurator"];i.events.convert_to_sub_assembly(t,i)},condition:function(t){return!t.expandable},btnClass:"hidden-xs"},{label:__(frappe.utils.icon("delete","sm")+" Item"),click:function(t){let i=frappe.views.trees["BOM Configurator"];i.events.delete_node(t,i)},condition:function(t){return!t.is_root},btnClass:"hidden-xs"}]:[{label:__("Expand All"),click:function(t){let i=frappe.views.trees["BOM Configurator"];t.expanded?(t.$tree_link.trigger("click"),t.$toolbar.find(".expand-all-btn").html("Expand All")):(i.tree.load_children(t,!0),$(t.parent[0]).find(".tree-children").show(),t.$toolbar.find(".expand-all-btn").html("Collapse All"))},condition:function(t){return t.expandable&&t.is_root},btnClass:"hidden-xs expand-all-btn"}]}}add_item(e,r){frappe.prompt([{label:__("Item"),fieldname:"item_code",fieldtype:"Link",options:"Item",reqd:1},{label:__("Qty"),fieldname:"qty",default:1,fieldtype:"Float",reqd:1}],a=>{e.data.parent_id||(e.data.parent_id=this.frm.doc.name),frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_item",args:{parent:e.data.parent_id,fg_item:e.data.value,item_code:a.item_code,fg_reference_id:e.data.name||this.frm.doc.name,qty:a.qty},callback:t=>{r.events.load_tree(t,e)}})},__("Add Item"),__("Add"))}set_query_for_workstation(e){let r=e.fields.filter(a=>a.fieldname==="workstation");r.length&&(r[0].get_query=function(){if(e.get_value("workstation_type"))return{filters:{workstation_type:e.get_value("workstation_type")}}})}add_sub_assembly(e,r){let a=new frappe.ui.Dialog({fields:r.events.get_sub_assembly_modal_fields(r,e.is_root),title:__("Add Sub Assembly")});r.events.set_query_for_workstation(a),a.show(),a.set_primary_action(__("Add"),()=>{var i;let t=a.get_values();a.operation&&!a.workstation_type&&!a.workstation&&frappe.throw(__("Either Workstation or Workstation Type is mandatory")),(i=e.data)!=null&&i.parent_id||(e.data.parent_id=this.frm.doc.name),frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_sub_assembly",args:{parent:e.data.parent_id,fg_item:e.data.value,fg_reference_id:e.data.name||this.frm.doc.name,bom_item:t,operation:e.data.operation,workstation_type:e.data.workstation_type,operation_time:e.data.operation_time},callback:o=>{r.events.load_tree(o,e)}}),a.hide()})}get_sub_assembly_modal_fields(e,r=!1,a=!1,t=!1){let i=[{label:__("Sub Assembly Item"),fieldname:"item_code",fieldtype:"Link",options:"Item",reqd:1,read_only:a},{fieldtype:"Column Break"},{label:__("Qty"),fieldname:"qty",default:1,fieldtype:"Float",reqd:1,read_only:a}];return this.frm.doc.track_operations&&(r||t)&&(i.push({fieldtype:"Section Break"},{label:__("Operation"),fieldname:"operation",fieldtype:"Link",options:"Operation",reqd:1},{label:__("Operation Time"),fieldname:"operation_time",fieldtype:"Int",reqd:1},{label:__("Is Subcontracted"),fieldname:"is_subcontracted",fieldtype:"Check"},{fieldtype:"Column Break"},{label:__("Workstation Type"),fieldname:"workstation_type",fieldtype:"Link",options:"Workstation Type"},{label:__("Workstation"),fieldname:"workstation",fieldtype:"Link",options:"Workstation"}),this.frm.doc.track_semi_finished_goods&&i.push({label:__("Default Warehouse"),fieldtype:"Section Break",collapsible:1},{label:__("Skip Material Transfer"),fieldname:"skip_material_transfer",fieldtype:"Check"},{label:__("Backflush Materials From WIP"),fieldname:"backflush_from_wip_warehouse",fieldtype:"Check",depends_on:"eval:doc.skip_material_transfer"},{label:__("Source Warehouse"),fieldname:"source_warehouse",fieldtype:"Link",options:"Warehouse",depends_on:"eval:!doc.backflush_from_wip_warehouse",get_query(){return{filters:{company:e.events.frm.doc.company}}}},{fieldtype:"Column Break"},{label:__("Work In Progress Warehouse"),fieldname:"wip_warehouse",fieldtype:"Link",options:"Warehouse",depends_on:"eval:!doc.skip_material_transfer || doc.backflush_from_wip_warehouse",get_query(){return{filters:{company:e.events.frm.doc.company}}}},{label:__("Finished Good Warehouse"),fieldname:"fg_warehouse",fieldtype:"Link",options:"Warehouse",get_query(){return{filters:{company:e.events.frm.doc.company}}}})),i.push({fieldtype:"Section Break"},{label:__("Raw Materials"),fieldname:"items",fieldtype:"Table",reqd:1,fields:[{label:__("Item"),fieldname:"item_code",fieldtype:"Link",options:"Item",reqd:1,in_list_view:1,change(){let o=this.doc;o.qty=1,this.grid.set_value("qty",1,o)}},{label:__("Qty"),fieldname:"qty",default:1,fieldtype:"Float",reqd:1,in_list_view:1}]}),i}convert_to_sub_assembly(e,r){let a=new frappe.ui.Dialog({fields:r.events.get_sub_assembly_modal_fields(r,e.is_root,!0,!0),title:__("Add Sub Assembly")});a.set_values({item_code:e.data.value,qty:e.data.qty}),a.show(),a.set_primary_action(__("Add"),()=>{let t=a.get_values();a.operation&&!a.workstation_type&&!a.workstation&&frappe.throw(__("Either Workstation or Workstation Type is mandatory")),frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.add_sub_assembly",args:{parent:e.data.parent_id,fg_item:e.data.value,bom_item:t,fg_reference_id:e.data.name||this.frm.doc.name,convert_to_sub_assembly:!0,operation:e.data.operation,workstation_type:e.data.workstation_type,operation_time:e.data.operation_time,workstation:e.data.workstation},callback:i=>{e.expandable=!0,r.events.load_tree(i,e.parent_node)}}),a.hide()})}set_default_qty(e){e.fields_dict.items.grid.fields_map.item_code.onchange=function(r){if(r){let a=$(r.currentTarget).closest(".grid-row").attr("data-name"),t=e.fields_dict.items.grid.grid_rows_by_docname[a].doc;t.qty=1,e.fields_dict.items.grid.refresh()}}}delete_node(e,r){frappe.confirm(__("Are you sure you want to delete this Item?"),()=>{frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.delete_node",args:{parent:e.data.parent_id,fg_item:e.data.value,doctype:e.data.doctype,docname:e.data.name},callback:a=>{r.events.load_tree(a,e.parent_node)}})})}edit_bom(e,r){let a=this,t=e.data.qty||this.frm.doc.qty,i=[{label:__("Qty"),fieldname:"qty",default:t,fieldtype:"Float",reqd:1}];if(e.expandable&&this.frm.doc.track_operations){let o=e.data.operation?e.data:this.frm.doc;i=[...i,{fieldtype:"Section Break"},{label:__("Operation"),fieldname:"operation",fieldtype:"Link",options:"Operation",default:o.operation},{label:__("Operation Time"),fieldname:"operation_time",fieldtype:"Float",default:o.operation_time},{label:__("Is Subcontracted"),fieldname:"is_subcontracted",fieldtype:"Check",hidden:(e==null?void 0:e.is_root)||0,default:o.is_subcontracted},{fieldtype:"Column Break"},{label:__("Workstation Type"),fieldname:"workstation_type",fieldtype:"Link",options:"Workstation Type",default:o.workstation_type},{label:__("Workstation"),fieldname:"workstation",fieldtype:"Link",options:"Workstation",default:o.workstation,get_query(){let n=a.frm.edit_bom_dialog;if(n.get_value("workstation_type"))return{filters:{workstation_type:n.get_value("workstation_type")}}}},{fieldtype:"Section Break"},{label:__("Skip Material Transfer"),fieldname:"skip_material_transfer",fieldtype:"Check",default:o.skip_material_transfer},{label:__("Backflush Materials From WIP"),fieldname:"backflush_from_wip_warehouse",fieldtype:"Check",depends_on:"eval:doc.skip_material_transfer",default:o.backflush_from_wip_warehouse},{label:__("Source Warehouse"),fieldname:"source_warehouse",fieldtype:"Link",options:"Warehouse",default:o.source_warehouse,depends_on:"eval:!doc.backflush_from_wip_warehouse",get_query(){return{filters:{company:a.frm.doc.company}}}},{fieldtype:"Column Break"},{label:__("Work In Progress Warehouse"),fieldname:"wip_warehouse",fieldtype:"Link",options:"Warehouse",default:o.wip_warehouse,depends_on:"eval:!doc.skip_material_transfer || doc.backflush_from_wip_warehouse",get_query(){return{filters:{company:a.frm.doc.company}}}},{label:__("Finished Good Warehouse"),fieldname:"fg_warehouse",fieldtype:"Link",options:"Warehouse",default:o.fg_warehouse,get_query(){return{filters:{company:a.frm.doc.company}}}}]}this.frm.edit_bom_dialog=frappe.prompt(i,o=>{let n=e.data.doctype||this.frm.doc.doctype,s=e.data.name||this.frm.doc.name;frappe.call({method:"erpnext.manufacturing.doctype.bom_creator.bom_creator.edit_bom_creator",args:{doctype:n,docname:s,data:o,parent:e.data.parent_id||this.frm.doc.name},callback:c=>{for(let p in o)e.data[p]=o[p];let u=e.data.uom||this.frm.doc.uom;$(e.parent.get(0)).find(`[data-bom-qty-docname='${s}']`).html(o.qty+" "+u),r.events.load_tree(c,e)}})},__("Edit BOM"),__("Update"))}prepare_layout(){let e=$(this.page)[0];e.style.marginBottom="15px",$(e).find(".tree-children")[0].style.minHeight="370px",$(e).find(".tree-children")[0].style.maxHeight="370px",$(e).find(".tree-children")[0].style.overflowY="auto"}load_tree(e,r){let a="",t="",i=e.message.raw_material_cost;for(frappe.views.trees["BOM Configurator"].tree.load_children(r);r;)a=e.message.items.filter(o=>o.name===r.data.name),a!=null&&a.length?(r.data.amount=a[0].amount,i=r.data.amount):i=e.message.raw_material_cost,t=$(r.parent.get(0)),i=frappe.format(i,{fieldtype:"Currency",currency:this.frm.doc.currency}),$($(t).find(".fg-item-amt")[0]).html(i),r=r.parent_node}};frappe.ui.BOMConfigurator=d;})();
//# sourceMappingURL=bom_configurator.bundle.IOXY5V33.js.map
